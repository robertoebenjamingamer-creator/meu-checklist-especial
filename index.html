<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Checklist de Rotina - Presente de AniversÃ¡rio</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
Â  Â  
Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-color: #6366f1; /* Indigo 500 */
Â  Â  Â  Â  Â  Â  --secondary-color: #fcd34d; /* Amber 300 */
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6; /* Gray 100 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .task-item {
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
Â  Â  Â  Â  }
Â  Â  Â  Â  .task-completed {
Â  Â  Â  Â  Â  Â  background-color: #d1fae5; /* Green 100 */
Â  Â  Â  Â  Â  Â  border-left: 5px solid #10b981; /* Emerald 500 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .task-completed .task-text {
Â  Â  Â  Â  Â  Â  text-decoration: line-through;
Â  Â  Â  Â  Â  Â  color: #6b7280; /* Gray 500 */
Â  Â  Â  Â  }
Â  Â  Â  Â  .task-default {
Â  Â  Â  Â  Â  Â  background-color: #ffffff;
Â  Â  Â  Â  Â  Â  border-left: 5px solid var(--primary-color);
Â  Â  Â  Â  }
Â  Â  Â  Â  .timer-running {
Â  Â  Â  Â  Â  Â  background-color: #fef3c7; /* Amber 100 */
Â  Â  Â  Â  Â  Â  border-left: 5px solid #fbbf24; /* Amber 400 */
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Estilo para animaÃ§Ã£o de botÃ£o */
Â  Â  Â  Â  .check-btn {
Â  Â  Â  Â  Â  Â  transition: transform 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .check-btn:active {
Â  Â  Â  Â  Â  Â  transform: scale(0.9);
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

Â  Â  <header class="text-center mb-10">
Â  Â  Â  Â  <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight">
Â  Â  Â  Â  Â  Â  ðŸŽ‰ Checklist de Rotina <span class="text-indigo-600">Especial</span> ðŸŽ‰
Â  Â  Â  Â  </h1>
Â  Â  Â  Â  <p class="text-lg text-gray-600 mt-2">Um presente de aniversÃ¡rio cheio de amor e organizaÃ§Ã£o!</p>
Â  Â  Â  Â  
Â  Â  Â  Â  <button id="music-btn" onclick="toggleMusic()" class="mt-4 px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition shadow-md">
Â  Â  Â  Â  Â  Â  <i class="fas fa-volume-mute"></i> MÃºsica: Desligada
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <p id="user-id-display" class="text-xs text-gray-400 mt-2"></p>
Â  Â  </header>

Â  Â  <main id="checklist-container" class="max-w-4xl mx-auto space-y-12">
Â  Â  Â  Â  <div id="loading-indicator" class="text-center p-6 bg-white rounded-xl shadow-lg">
Â  Â  Â  Â  Â  Â  <i class="fas fa-spinner fa-spin text-3xl text-indigo-500"></i>
Â  Â  Â  Â  Â  Â  <p class="mt-2 text-gray-600">Carregando a rotina...</p>
Â  Â  Â  Â  </div>
Â  Â  </main>

Â  Â  <div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
Â  Â  Â  Â  <div class="bg-white rounded-xl p-6 w-full max-w-sm shadow-2xl">
Â  Â  Â  Â  Â  Â  <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-4"></h3>
Â  Â  Â  Â  Â  Â  <p id="modal-message" class="text-gray-600 mb-6"></p>
Â  Â  Â  Â  Â  Â  <div class="flex justify-end space-x-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Cancelar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="modal-confirm-btn" class="px-4 py-2 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Confirmar
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

    <script>
        // Suas credenciais completas do Firebase, conforme fornecido:
        const firebaseConfig = {
            apiKey: "AIzaSyCX3oqp970BQZPG0pgOOCfqO_2GxkWZL7Q",
            authDomain: "meu-checklist-especial.firebaseapp.com",
            projectId: "meu-checklist-especial",
            storageBucket: "meu-checklist-especial.firebasestorage.app",
            messagingSenderId: "315598440945",
            appId: "1:315598440945:web:eff1cd2eb1e5217d529c50",
            measurementId: "G-J3VPMK2DH3"
        };
        
        // --- FormataÃ§Ã£o para o cÃ³digo do Checklist (NÃ£o altere estas linhas) ---
        
        // 1. O App ID Ã© usado para o caminho de salvamento no Firestore
        const __app_id = firebaseConfig.appId; 
        
        // 2. A configuraÃ§Ã£o de inicializaÃ§Ã£o precisa ser uma string JSON
        const __firebase_config = JSON.stringify(firebaseConfig);
        
        // 3. Mantemos 'null' para o token de autenticaÃ§Ã£o inicial
        const __initial_auth_token = null; 
    </script>
    Â  Â  <script type="module">
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, doc, setDoc, onSnapshot, collection, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  // VariÃ¡veis Globais do Canvas (ObrigatÃ³rias)
Â  Â  Â  Â  // Elas agora sÃ£o lidas do bloco <script> acima
Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-checklist-app-id';
Â  Â  Â  Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
Â  Â  Â  Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

Â  Â  Â  Â  let db;
Â  Â  Â  Â  let auth;
Â  Â  Â  Â  let userId = null;
Â  Â  Â  Â  let isAuthReady = false;

Â  Â  Â  Â  const STATE = {
Â  Â  Â  Â  Â  Â  tasks: {}, // {taskId: boolean} - Completion status
Â  Â  Â  Â  Â  Â  timerStart: null,
Â  Â  Â  Â  Â  Â  timerRemaining: 7200, // 2 hours in seconds (7200)
Â  Â  Â  Â  Â  Â  timerInterval: null,
Â  Â  Â  Â  Â  Â  lastCheckDate: null, // Rastreia o Ãºltimo dia de uso (YYYY-MM-DD)
Â  Â  Â  Â  };

Â  Â  Â  Â  const TASK_DATA = {
Â  Â  Â  Â  Â  Â  mom: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-1', text: 'Acordar' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-2', text: 'Dar comida para o peixe Bilisco' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-3', text: 'Fazer o cafÃ© da manhÃ£' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-4', text: 'Lavar a louÃ§a (pÃ³s-cafÃ©)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-5', text: 'Passar a vassoura na casa' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-6', text: 'Lavar a roupa (inÃ­cio)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-7', text: 'Cozinhar o almoÃ§o' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-8', text: 'Lavar a louÃ§a (pÃ³s-almoÃ§o)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-9', text: 'Reclamar com as crianÃ§as para tomar banho (pÃ³s-escola)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-10', text: 'Ler a BÃ­blia' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-11', text: 'Orar' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-12', text: 'Fazer o cafÃ© da noite (Jantar)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'mom-13', text: 'Lavar a louÃ§a (pÃ³s-jantar)' },
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  kids: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-1', text: 'Levantar' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-2', text: 'Tomar cafÃ©' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-3', text: 'Trocar a roupa' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-4', text: 'Ler a BÃ­blia' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-5', text: 'Escovar os dentes (manhÃ£)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-6', text: 'Ir para a Escola' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-7', text: 'Voltar da escola' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-8', text: 'Tomar banho (pÃ³s-escola)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-9', text: 'Arrumar as coisas/organizar o quarto' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-10', text: 'Escovar os dentes (pÃ³s-jantar)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-11', text: 'Fazer o dever de casa' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-12', text: '2h de Tela (CronÃ´metro) â³' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-13', text: 'Tomar o cafÃ©/lanche da noite' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-14', text: 'Escovar os dentes (antes de dormir)' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'kid-15', text: 'Dormir' },
Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  secondary: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sec-2', text: 'Trocar a Ã¡gua do aquÃ¡rio do Bilisco (duas em 2 semanas)' },
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  };

Â  Â  Â  Â  const FIREBASE_DOC_ID = 'tasks';

Â  Â  Â  Â  // --- ConfiguraÃ§Ã£o e InicializaÃ§Ã£o do Firebase ---

Â  Â  Â  Â  function initFirebase() {
Â  Â  Â  Â  Â  Â  if (!firebaseConfig) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase config is missing.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  Â  Â  setLogLevel('Debug'); // Para logs Ãºteis
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro ao inicializar Firebase:", error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function authenticate() {
Â  Â  Â  Â  Â  Â  if (!auth) return;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (initialAuthToken) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInWithCustomToken(auth, initialAuthToken);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro na autenticaÃ§Ã£o:", error);
Â  Â  Â  Â  Â  Â  Â  Â  // Tenta anonimamente como fallback
Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth).catch(err => console.error("Falha na autenticaÃ§Ã£o anÃ´nima:", err));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FunÃ§Ãµes de PersistÃªncia (Firestore) ---

Â  Â  Â  Â  function getTaskRef() {
Â  Â  Â  Â  Â  Â  if (!db || !userId) return null;
Â  Â  Â  Â  Â  Â  // O caminho da coleÃ§Ã£o deve incluir o userId apÃ³s a autenticaÃ§Ã£o
Â  Â  Â  Â  Â  Â  return doc(db, `artifacts/${appId}/users/${userId}/birthday_checklist`, FIREBASE_DOC_ID);
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // FunÃ§Ã£o auxiliar para obter o estado inicial de todas as tarefas
Â  Â  Â  Â  function getInitialTaskState() {
Â  Â  Â  Â  Â  Â  const initialTasks = {};
Â  Â  Â  Â  Â  Â  // Garante que as tarefas incluÃ­das estejam inicializadas como false
Â  Â  Â  Â  Â  Â  const allTasks = [...TASK_DATA.mom, ...TASK_DATA.kids, ...TASK_DATA.secondary];Â 
Â  Â  Â  Â  Â  Â  allTasks.forEach(task => { initialTasks[task.id] = false; });
Â  Â  Â  Â  Â  Â  return initialTasks;
Â  Â  Â  Â  }

Â  Â  Â  Â  async function loadTasks() {
Â  Â  Â  Â  Â  Â  const taskRef = getTaskRef();
Â  Â  Â  Â  Â  Â  const loadingIndicator = document.getElementById('loading-indicator');

Â  Â  Â  Â  Â  Â  if (!taskRef) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("ReferÃªncia do Firestore nÃ£o disponÃ­vel.");
Â  Â  Â  Â  Â  Â  Â  Â  if (loadingIndicator) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadingIndicator.innerHTML = '<p class="text-red-500">Erro: NÃ£o foi possÃ­vel carregar o estado (Firestore indisponÃ­vel).</p>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ObtÃ©m a data de hoje formatada como YYYY-MM-DD
Â  Â  Â  Â  Â  Â  const todayDateString = new Date().toISOString().slice(0, 10);

Â  Â  Â  Â  Â  Â  // Usar onSnapshot para escutar em tempo real
Â  Â  Â  Â  Â  Â  onSnapshot(taskRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (loadingIndicator) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadingIndicator.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  let loadedData = {};
Â  Â  Â  Â  Â  Â  Â  Â  let checklistNeedsReset = false;

Â  Â  Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadedData = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastCheckDate = loadedData.lastCheckDate;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // CHECK 1: Se for um novo dia (a data salva Ã© diferente da data de hoje), reinicia o checklist
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (lastCheckDate && lastCheckDate !== todayDateString) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Novo dia detectado. Reiniciando checklist.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checklistNeedsReset = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Documento nÃ£o encontrado. Inicializando estado.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  checklistNeedsReset = true; // Inicializa se o documento nÃ£o existir
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // LÃ³gica de Reset
Â  Â  Â  Â  Â  Â  Â  Â  if (checklistNeedsReset) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks = getInitialTaskState();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerStart = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = 7200; // Reseta para 2 horas
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.lastCheckDate = todayDateString; // Define a nova data
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Para qualquer intervalo de timer existente para evitar problemas
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (STATE.timerInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(STATE.timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState(); // Persiste o reset (Isso irÃ¡ disparar onSnapshot novamente, mas a verificaÃ§Ã£o de data impedirÃ¡ um novo reset)
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Carrega os dados existentes (incluindo o estado de resetado se for o caso)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // TambÃ©m garante que novas tarefas sejam inicializadas como false
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const existingTasks = loadedData.tasks || {};
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allInitialTasks = getInitialTaskState();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Mescla o estado salvo com as tarefas iniciais (garante que novas tarefas sejam 'false')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks = { ...allInitialTasks, ...existingTasks };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerStart = loadedData.timerStart || null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = loadedData.timerRemaining || 7200;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.lastCheckDate = loadedData.lastCheckDate || todayDateString;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  console.log("Dados carregados/atualizados do Firestore.", STATE);

Â  Â  Â  Â  Â  Â  Â  Â  startTimer(); // Garante que o timer inicie/recalcule
Â  Â  Â  Â  Â  Â  Â  Â  renderChecklist();

Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro ao escutar dados do Firestore:", error);
Â  Â  Â  Â  Â  Â  Â  Â  if (loadingIndicator) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadingIndicator.innerHTML = '<p class="text-red-500">Erro: Falha ao sincronizar dados.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  async function saveState() {
Â  Â  Â  Â  Â  Â  if (!isAuthReady || !getTaskRef()) return;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Atualiza a data de Ãºltima verificaÃ§Ã£o (hoje) antes de salvar
Â  Â  Â  Â  Â  Â  const todayDateString = new Date().toISOString().slice(0, 10);
Â  Â  Â  Â  Â  Â  STATE.lastCheckDate = todayDateString;Â 

Â  Â  Â  Â  Â  Â  const stateToSave = {
Â  Â  Â  Â  Â  Â  Â  Â  tasks: STATE.tasks,
Â  Â  Â  Â  Â  Â  Â  Â  timerStart: STATE.timerStart,
Â  Â  Â  Â  Â  Â  Â  Â  timerRemaining: STATE.timerRemaining,
Â  Â  Â  Â  Â  Â  Â  Â  lastCheckDate: STATE.lastCheckDate // Salva a data para o reset diÃ¡rio
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Salva na coleÃ§Ã£o privada do usuÃ¡rio
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(getTaskRef(), stateToSave, { merge: true });
Â  Â  Â  Â  Â  Â  Â  Â  // console.log("Estado salvo com sucesso.");
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erro ao salvar o estado: ", e);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FunÃ§Ãµes de Ãudio (Tone.js) ---
Â  Â  Â  Â  let clickSynth;
Â  Â  Â  Â  let ambientSynth;
Â  Â  Â  Â  let ambientLoop;
Â  Â  Â  Â  let isMusicPlaying = false;

Â  Â  Â  Â  function setupAudio() {
Â  Â  Â  Â  Â  Â  // 1. Click Sound (Um sino/clique rÃ¡pido para feedback)
Â  Â  Â  Â  Â  Â  clickSynth = new Tone.MembraneSynth({
Â  Â  Â  Â  Â  Â  Â  Â  pitchDecay: 0.008,
Â  Â  Â  Â  Â  Â  Â  Â  envelope: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attack: 0.001,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  decay: 0.2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sustain: 0.01,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  release: 0.01,
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).toDestination();

Â  Â  Â  Â  Â  Â  // 2. Ambient Music (Volume baixo, loop simples e calmo)
Â  Â  Â  Â  Â  Â  ambientSynth = new Tone.PolySynth(Tone.Synth, {
Â  Â  Â  Â  Â  Â  Â  Â  oscillator: { type: "sine" },
Â  Â  Â  Â  Â  Â  Â  Â  envelope: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attack: 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  decay: 0.1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sustain: 0.9,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  release: 4,
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).chain(new Tone.Volume(-20).toDestination()); // Volume definido para -20dB (muito baixo)

Â  Â  Â  Â  Â  Â  // 3. O Loop (progressÃ£o de acordes lenta)
Â  Â  Â  Â  Â  Â  const loopChords = ["C3", "G3", "A3", "F3"];
Â  Â  Â  Â  Â  Â  let chordIndex = 0;
Â  Â  Â  Â  Â  Â  ambientLoop = new Tone.Loop(time => {
Â  Â  Â  Â  Â  Â  Â  Â  const chord = loopChords[chordIndex % loopChords.length];
Â  Â  Â  Â  Â  Â  Â  Â  ambientSynth.triggerAttackRelease(chord, "4n", time);
Â  Â  Â  Â  Â  Â  Â  Â  chordIndex++;
Â  Â  Â  Â  Â  Â  }, "4n").start(0);Â 

Â  Â  Â  Â  Â  Â  Tone.Transport.bpm.value = 60; // Tempo lento e calmo
Â  Â  Â  Â  }

Â  Â  Â  Â  function playClick() {
Â  Â  Â  Â  Â  Â  // Toca o som de clique
Â  Â  Â  Â  Â  Â  if (clickSynth && Tone.context.state === 'running') {
Â  Â  Â  Â  Â  Â  Â  Â  clickSynth.triggerAttackRelease("G4", "8n");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.toggleMusic = function() {
Â  Â  Â  Â  Â  Â  // O Tone.start() Ã© necessÃ¡rio para ativar o Ã¡udio em navegadores mÃ³veis apÃ³s interaÃ§Ã£o
Â  Â  Â  Â  Â  Â  if (Tone.context.state !== 'running') {
Â  Â  Â  Â  Â  Â  Â  Â  Tone.start();Â 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (isMusicPlaying) {
Â  Â  Â  Â  Â  Â  Â  Â  Tone.Transport.stop();
Â  Â  Â  Â  Â  Â  Â  Â  isMusicPlaying = false;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Tone.Transport.start();
Â  Â  Â  Â  Â  Â  Â  Â  isMusicPlaying = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateMusicButton();
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateMusicButton() {
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('music-btn');
Â  Â  Â  Â  Â  Â  if (btn) {
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerHTML = isMusicPlayingÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? '<i class="fas fa-volume-up"></i> MÃºsica: Ligada'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : '<i class="fas fa-volume-mute"></i> MÃºsica: Desligada';
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('bg-gray-500', !isMusicPlaying);
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('hover:bg-gray-600', !isMusicPlaying);
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('bg-green-500', isMusicPlaying);
Â  Â  Â  Â  Â  Â  Â  Â  btn.classList.toggle('hover:bg-green-600', isMusicPlaying);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- FunÃ§Ãµes do CronÃ´metro (Task ID: kid-12) ---
Â  Â  Â  Â  
Â  Â  Â  Â  function formatTime(seconds) {
Â  Â  Â  Â  Â  Â  const h = Math.floor(seconds / 3600);
Â  Â  Â  Â  Â  Â  const m = Math.floor((seconds % 3600) / 60);
Â  Â  Â  Â  Â  Â  const s = seconds % 60;
Â  Â  Â  Â  Â  Â  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateTimerDisplay() {
Â  Â  Â  Â  Â  Â  const timerElement = document.getElementById('timer-display');
Â  Â  Â  Â  Â  Â  const taskItem = document.getElementById('task-kid-12');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!timerElement || !taskItem) return;

Â  Â  Â  Â  Â  Â  const display = formatTime(Math.max(0, STATE.timerRemaining));
Â  Â  Â  Â  Â  Â  timerElement.textContent = display;

Â  Â  Â  Â  Â  Â  taskItem.classList.remove('task-completed', 'timer-running', 'task-default');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (STATE.timerInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  taskItem.classList.add('timer-running');
Â  Â  Â  Â  Â  Â  } else if (STATE.timerRemaining <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  taskItem.classList.add('task-completed');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  taskItem.classList.add('task-default');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleTimer() {
Â  Â  Â  Â  Â  Â  if (!isAuthReady) return;

Â  Â  Â  Â  Â  Â  if (STATE.timerInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  // Parar o timer
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(STATE.timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = null;
Â  Â  Â  Â  Â  Â  Â  Â  // Recalcular o tempo restante exato antes de salvar
Â  Â  Â  Â  Â  Â  Â  Â  if (STATE.timerStart) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const elapsed = Math.floor((Date.now() - STATE.timerStart) / 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = Math.max(0, STATE.timerRemaining - elapsed);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerStart = null;
Â  Â  Â  Â  Â  Â  Â  Â  console.log("CronÃ´metro pausado. Restante:", STATE.timerRemaining);

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Iniciar/Continuar o timer
Â  Â  Â  Â  Â  Â  Â  Â  // Se estiver concluÃ­do e o tempo for 0, reseta para 2 horas
Â  Â  Â  Â  Â  Â  Â  Â  if (STATE.timerRemaining <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = 7200;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks['kid-12'] = false; // Desmarca ao reiniciar
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerStart = Date.now();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Reinicia a contagem
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = Math.max(0, STATE.timerRemaining - 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (STATE.timerRemaining <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(STATE.timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks['kid-12'] = true; // Marca como concluÃ­da
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("CronÃ´metro finalizado!");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("CronÃ´metro iniciado/continuado.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playClick(); // Toca o som no inÃ­cio/pausa
Â  Â  Â  Â  Â  Â  // Atualiza o display e salva o novo status (iniciado/pausado)
Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  saveState();Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  function resetTimer() {
Â  Â  Â  Â  Â  Â  if (STATE.timerInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(STATE.timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  STATE.timerStart = null;
Â  Â  Â  Â  Â  Â  STATE.timerRemaining = 7200; // 2 horas (7200 segundos)
Â  Â  Â  Â  Â  Â  STATE.tasks['kid-12'] = false; // Desmarca a tarefa
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  playClick(); // Toca o som no reset
Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  saveState();
Â  Â  Â  Â  }

Â  Â  Â  Â  function startTimer() {
Â  Â  Â  Â  Â  Â  if (STATE.timerInterval) {
Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(STATE.timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Verifica se o timer estava rodando antes de recarregar
Â  Â  Â  Â  Â  Â  if (STATE.timerStart && STATE.timerRemaining > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Calcula o tempo decorrido desde o Ãºltimo STATE.timerStart
Â  Â  Â  Â  Â  Â  Â  Â  const elapsedSinceStart = Math.floor((Date.now() - STATE.timerStart) / 1000);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // O tempo restante REAL deve ser o tempo restante persistido, menos o tempo decorrido
Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = Math.max(0, STATE.timerRemaining - elapsedSinceStart);

Â  Â  Â  Â  Â  Â  Â  Â  if (STATE.timerRemaining > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Reinicia o intervalo
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = Math.max(0, STATE.timerRemaining - 1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateTimerDisplay();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (STATE.timerRemaining <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clearInterval(STATE.timerInterval);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerInterval = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks['kid-12'] = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // console.log("CronÃ´metro retomado apÃ³s recarga. Restante:", STATE.timerRemaining);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.timerRemaining = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks['kid-12'] = true; // Marca como concluÃ­da se o tempo tiver acabado
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- FunÃ§Ãµes de UI e RenderizaÃ§Ã£o ---

Â  Â  Â  Â  function showModal(title, message, onConfirm) {
Â  Â  Â  Â  Â  Â  document.getElementById('modal-title').textContent = title;
Â  Â  Â  Â  Â  Â  document.getElementById('modal-message').textContent = message;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('modal');
Â  Â  Â  Â  Â  Â  modal.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  const confirmBtn = document.getElementById('modal-confirm-btn');
Â  Â  Â  Â  Â  Â  const cancelBtn = document.getElementById('modal-cancel-btn');

Â  Â  Â  Â  Â  Â  const handleConfirm = () => {
Â  Â  Â  Â  Â  Â  Â  Â  onConfirm();
Â  Â  Â  Â  Â  Â  Â  Â  modal.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.removeEventListener('click', handleConfirm);
Â  Â  Â  Â  Â  Â  Â  Â  cancelBtn.removeEventListener('click', handleCancel);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleCancel = () => {
Â  Â  Â  Â  Â  Â  Â  Â  modal.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.removeEventListener('click', handleConfirm);
Â  Â  Â  Â  Â  Â  Â  Â  cancelBtn.removeEventListener('click', handleCancel);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  confirmBtn.addEventListener('click', handleConfirm);
Â  Â  Â  Â  Â  Â  cancelBtn.addEventListener('click', handleCancel);
Â  Â  Â  Â  }

Â  Â  Â  Â  // FunÃ§Ã£o para alternar o estado de uma tarefa
Â  Â  Â  Â  window.toggleTask = function(taskId) {
Â  Â  Â  Â  Â  Â  if (!isAuthReady) {
Â  Â  Â  Â  Â  Â  Â  Â  showModal("Erro de AutenticaÃ§Ã£o", "Aguarde a autenticaÃ§Ã£o para salvar o progresso.", () => {});
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const currentState = STATE.tasks[taskId] || false;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (taskId === 'kid-12') {
Â  Â  Â  Â  Â  Â  Â  Â  // A tarefa '2h de Tela' Ã© controlada pelo timer.
Â  Â  Â  Â  Â  Â  Â  Â  if (currentState) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Desmarcar Tarefa",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Tem certeza que deseja desmarcar '2h de Tela'? Isso irÃ¡ resetar o cronÃ´metro para 2 horas.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  () => resetTimer()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Se tentar marcar manualmente enquanto o tempo estÃ¡ rodando/disponÃ­vel
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "AtenÃ§Ã£o - CronÃ´metro",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "A tarefa '2h de Tela' Ã© concluÃ­da automaticamente ao final do cronÃ´metro. Clique no botÃ£o de Play/Pause para gerenciar o tempo.",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  () => {} // Apenas fecha o modal
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // LÃ³gica normal para outras tarefas
Â  Â  Â  Â  Â  Â  STATE.tasks[taskId] = !currentState;
Â  Â  Â  Â  Â  Â  playClick(); // Toca o som ao marcar/desmarcar
Â  Â  Â  Â  Â  Â  saveState();
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  // FunÃ§Ã£o para construir o HTML de uma tarefa
Â  Â  Â  Â  function createTaskHtml(task, index, section) {
Â  Â  Â  Â  Â  Â  const isCompleted = STATE.tasks[task.id] === true;
Â  Â  Â  Â  Â  Â  let iconClass = 'fas fa-check';
Â  Â  Â  Â  Â  Â  let itemClasses = 'task-item p-4 rounded-xl flex items-center justify-between transition-all ' + (isCompleted ? 'task-completed' : 'task-default');
Â  Â  Â  Â  Â  Â  let contentHtml = `<span class="task-text text-gray-800 font-medium text-lg flex-1">${index}. ${task.text}</span>`;
Â  Â  Â  Â  Â  Â  let buttonHtml = '';

Â  Â  Â  Â  Â  Â  if (task.id === 'kid-12') { // Tratamento especial para o cronÃ´metro
Â  Â  Â  Â  Â  Â  Â  Â  const isRunning = STATE.timerInterval !== null;
Â  Â  Â  Â  Â  Â  Â  Â  const isFinished = STATE.timerRemaining <= 0;
Â  Â  Â  Â  Â  Â  Â  Â  const buttonIcon = isRunning ? 'fas fa-pause' : (isFinished ? 'fas fa-undo' : 'fas fa-play');
Â  Â  Â  Â  Â  Â  Â  Â  const buttonText = isRunning ? 'Pausar' : (isFinished ? 'Reiniciar' : 'Iniciar');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  contentHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="task-text text-gray-800 font-medium text-lg block">${index}. ${task.text}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center space-x-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-clock text-amber-600"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="timer-display" class="font-mono text-xl text-amber-800">02:00:00</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  buttonHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="${isFinished ? 'resetTimer()' : 'toggleTimer()'}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="check-btn px-4 py-2 ml-4 rounded-full ${isFinished ? 'bg-red-500 hover:bg-red-600' : 'bg-amber-500 hover:bg-amber-600'} text-white transition duration-150 shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="${buttonIcon}"></i> ${buttonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${!isRunning && STATE.timerRemaining < 7200 && !isFinished ? `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="resetTimer()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="check-btn px-4 py-2 ml-2 rounded-full bg-gray-500 text-white hover:bg-gray-600 transition duration-150 shadow-md">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-undo"></i> Resetar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // BotÃ£o de checkmark padrÃ£o
Â  Â  Â  Â  Â  Â  Â  Â  const btnColor = isCompleted ? 'bg-emerald-500 hover:bg-emerald-600' : 'bg-indigo-500 hover:bg-indigo-600';
Â  Â  Â  Â  Â  Â  Â  Â  buttonHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="toggleTask('${task.id}')"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="check-btn w-10 h-10 ml-4 rounded-full ${btnColor} text-white flex items-center justify-center shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="${iconClass}"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div id="task-${task.id}" class="${itemClasses}" data-task-id="${task.id}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${contentHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  // FunÃ§Ã£o principal de renderizaÃ§Ã£o
Â  Â  Â  Â  function renderChecklist() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('checklist-container');
Â  Â  Â  Â  Â  Â  if (!container) return;

Â  Â  Â  Â  Â  Â  let html = '';

Â  Â  Â  Â  Â  Â  // SeÃ§Ã£o 1: Tarefas da MÃ£e
Â  Â  Â  Â  Â  Â  html += createSectionHtml('Tarefas da MÃ£e', 'fas fa-female', 'text-indigo-600', TASK_DATA.mom);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // SeÃ§Ã£o 2: Rotina das CrianÃ§as
Â  Â  Â  Â  Â  Â  html += createSectionHtml('Rotina das CrianÃ§as', 'fas fa-child', 'text-pink-600', TASK_DATA.kids);

Â  Â  Â  Â  Â  Â  // SeÃ§Ã£o 3: Tarefas SecundÃ¡rias (Quinzenais/ocasionais)
Â  Â  Â  Â  Â  Â  html += createSectionHtml('Tarefas SecundÃ¡rias', 'fas fa-broom', 'text-teal-600', TASK_DATA.secondary);

Â  Â  Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  Â  Â  Â  updateTimerDisplay(); // Garante que o display do timer seja inicializado
Â  Â  Â  Â  Â  Â  updateMusicButton(); // Garante que o botÃ£o de mÃºsica reflita o estado atual
Â  Â  Â  Â  }

Â  Â  Â  Â  // FunÃ§Ã£o auxiliar para criar as seÃ§Ãµes
Â  Â  Â  Â  function createSectionHtml(title, icon, colorClass, tasks) {
Â  Â  Â  Â  Â  Â  let tasksHtml = tasks.map((task, index) => createTaskHtml(task, index + 1, title)).join('');

Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <section class="bg-white p-6 rounded-2xl shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold mb-6 flex items-center ${colorClass}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="${icon} mr-3"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${title}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${tasksHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- InicializaÃ§Ã£o ---

Â  Â  Â  Â  window.onload = function () {
Â  Â  Â  Â  Â  Â  // 1. Inicializa o Firebase
Â  Â  Â  Â  Â  Â  if (firebaseConfig) {
Â  Â  Â  Â  Â  Â  Â  Â  initFirebase();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // 2. CONFIGURA O LISTENER DE ESTADO DE AUTENTICAÃ‡ÃƒO AQUI, DEPOIS QUE 'auth' ESTÃ DEFINIDO
Â  Â  Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-id-display').textContent = `ID de UsuÃ¡rio: ${userId}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Depois de autenticar, podemos carregar os dados
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadTasks();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("UsuÃ¡rio deslogado/nÃ£o autenticado. Usando anonimamente.");
                        // Inicia o processo de autenticaÃ§Ã£o (fallback ou inicial)
                        await authenticate();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // 3. Configura o Ã¡udio (sem iniciar o loop, para evitar auto-play)
Â  Â  Â  Â  Â  Â  Â  Â  setupAudio();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Se nÃ£o houver configuraÃ§Ã£o, apenas renderiza localmente
Â  Â  Â  Â  Â  Â  Â  Â  console.warn("ConfiguraÃ§Ã£o do Firebase ausente. O progresso NÃƒO serÃ¡ salvo.");
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-indicator').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = true; // Permite o uso da interface
Â  Â  Â  Â  Â  Â  Â  Â  // Inicializa o estado com as tarefas desmarcadas
Â  Â  Â  Â  Â  Â  Â  Â  STATE.tasks = getInitialTaskState();
Â  Â  Â  Â  Â  Â  Â  Â  renderChecklist();
Â  Â  Â  Â  Â  Â  Â  Â  updateTimerDisplay();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  </script>


</body>
</html>
